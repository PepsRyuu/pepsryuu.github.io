'use strict';

function normalize (e) {
    e.preventDefault();
    e = e.touches? e.touches[0] : e;
    return { x: e.pageX, y: e.pageY };
}

function DragGesture (e, onMove, onEnd) {
    var start = normalize(e);

    var onMouseMove = function (e) {
        var curr = normalize(e);

        if (onMove) {
            onMove({
                x: curr.x - start.x,
                y: curr.y - start.y
            }, e);
        }
    };

    var onMouseUp = function (e) {
        for (var key in events) {
            document.removeEventListener(key, events[key]);
        }

        var curr = normalize(e);

        if (onEnd) {
            onEnd({
                x: curr.x - start.x,
                y: curr.y - start.y
            }, e);
        }
    };

    var events = {
        'mouseup': onMouseUp,
        'mouseleave': onMouseUp,
        'mousemove': onMouseMove,
        'mousedown': function (e) { return e.preventDefault(); },
        'touchmove': onMouseMove,
        'touchend': onMouseUp
    };

    for (var key in events) {
        document.addEventListener(key, events[key]);
    }
}

module.exports = DragGesture;
